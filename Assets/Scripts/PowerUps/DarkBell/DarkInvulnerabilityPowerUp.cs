using UnityEngine;

[CreateAssetMenu(fileName = "DarkInvulnerabilityPowerUp", menuName = "PowerUps/Dark Invulnerability")]
public class DarkInvulnerabilityPowerUp : PowerUp
{
    [Header("Configuraci√≥n")]
    public float activationHealthThreshold = 1f;
    public float invulnerabilityDuration = 20f;
    public GameObject darknessProjectilePrefab;
    public int numberOfProjectiles = 5;
    public float projectileSpawnDistance = 3f;
    public float recoveryTransitionTime = 3f;
    public float healAmountPerOrb = 0.5f;

    public override void Apply(PlayerController player)
    {
        var darkPower = player.GetComponent<DarkInvulnerabilityPower>();
        if (darkPower == null)
        {
            darkPower = player.gameObject.AddComponent<DarkInvulnerabilityPower>();
        }

        // Configurar el sistema
        darkPower.activationHealthThreshold = activationHealthThreshold;
        darkPower.invulnerabilityDuration = invulnerabilityDuration;
        darkPower.darknessProjectilePrefab = darknessProjectilePrefab;
        darkPower.numberOfProjectiles = numberOfProjectiles;
        darkPower.projectileSpawnDistance = projectileSpawnDistance;
        darkPower.recoveryTransitionTime = recoveryTransitionTime;
        darkPower.healAmountPerOrb = healAmountPerOrb;

        darkPower.ActivatePower();
        darkPower.enabled = true;
    }

    public override void Remove(PlayerController player)
    {
        var darkPower = player.GetComponent<DarkInvulnerabilityPower>();
        if (darkPower != null)
        {
            darkPower.DeactivatePower();
            darkPower.enabled = false;
        }
    }
}